# 第8章 分布式系统的挑战

[TOC]

作为开发真，我们的核心任务是构建可靠的系统，即使系统面临各种出错可能，也需要完成既定工作（确保满足用户期望）。

故障处理是软件设计的重要组成部分。

作为系统运维者，需要知道在发生故障时，系统的预期行为是什么。

在分布式系统中，怀疑、悲观和偏执狂才能生存。

对于分布式环境，我们的目标是建立容忍部分失效的软件系统，这样即使某些部件发生失效，系统整体还可以继续运行。

# 名次解释

高性能计算（high-performance computing，HPC）

远程内存直接访问（RDMA）

Clos拓扑结构

网络分区：当网络的一部分由于网络故障而与其它部分断开，称之为网络分区或网络分割。

# 故障与部分失效

在分布式系统中，可能会出现系统的一部分工作正常，但其它某些部分出现难以预测的故障，我们称之为“部分失效”。

问题的难点在于这种部分失效是不确定的。正是由于这种不确定性和部分失效大大提高了分布式系统的复杂性。

# 不可靠的网络

网络中的可变延迟并不是一种自然规律，只是成本与收益相互博弈的结果。

# 不可靠时钟

在分布式系统中，时间总是棘手的问题。

可以在一定程度上同步机器之间的时钟，最常用的方法是网络时间协议NTP（Network Time Protocol）它可以根据一组专门的时间服务器来调整本地时间。

现代计算机内部至少有两种不同的时钟：一个是墙上时钟，一个是单调时钟。虽然它们都可以衡量时间，但要仔细区分二者，本质上它们是服务不同的目的。

## 单调时钟

单调时钟更适合测量时间间隔，例如超时或服务的响应时间，例如Java中的Syste.nanoTime返回的即是单调时钟。

## 墙上时钟

墙上时钟根据某个日历返回当前的日期与时间。例如Java中的System.currentTimeMillis()会返回自纪元1970年1月1日（UTC）以来的秒数和毫秒数，不含闰秒。

## 时钟同步与准确性

单调时钟不需要同步，但是墙上时钟需有根据NTP服务器或其他外部世界源做必要的调整。

# 拜占庭故障

**节点明明没有收到某条消息，单却对外声称收到了。这种行为称为拜占庭故障。**在这样不信任的环境中需要达成共识的问题也被称为拜占庭将军问题。

像比特币和其他区块链一样的点对点网络就是让**互不信任**的当事方**就某项交易达成一致**，**且不依赖于集中的机制**。

**防止分配超大内存**导致拒绝服务攻击。



# 节点失效系统模型

- 崩溃-中止模型
- 崩溃-恢复模型
- 拜占庭（任意）失效模型





